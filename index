<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivial: Vida de San Josemaría Escrivá</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #46178f;
            color: white;
            overflow-x: hidden;
            margin: 0;
        }

        .kahoot-btn {
            transition: transform 0.1s, box-shadow 0.1s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .kahoot-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        .option-0 { background-color: #e21b3c; }
        .option-1 { background-color: #1368ce; }
        .option-2 { background-color: #d89e00; }
        .option-3 { background-color: #26890c; }

        .progress-bar {
            transition: width 0.1s linear;
        }

        .shape { opacity: 0.3; font-size: 1.2rem; }

        .modal-enter {
            animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .bg-animate {
            background: linear-gradient(45deg, #46178f, #5a1ea3);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #music-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 100;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-animate">

    <!-- Audio Elements -->
    <audio id="audio-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="audio-wrong" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
    <audio id="audio-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
    <audio id="audio-bg" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" loop></audio>

    <div id="music-toggle" onclick="toggleMusic()">
        <i id="music-icon" class="fas fa-volume-up text-white"></i>
    </div>

    <!-- Pantalla de Inicio -->
    <div id="start-screen" class="flex-grow flex flex-col items-center justify-center p-6 text-center">
        <div class="bg-white p-8 rounded-3xl text-center shadow-2xl max-w-md w-full text-slate-800">
            <h1 class="text-3xl font-black mb-4 text-[#46178f]">Vida de San Josemaría</h1>
            <p class="text-lg mb-6 font-medium text-slate-600">"Todos podemos ser santos"</p>
            <button onclick="startGame()" class="w-full bg-[#26890c] hover:bg-[#1f6d0a] text-white font-bold py-4 rounded-xl text-xl transition-all shadow-lg">
                ¡EMPEZAR!
            </button>
            <p class="text-xs mt-4 text-slate-400 italic">por Gabriel Bailly-Bailliere Torres-Pardo</p>
        </div>
    </div>

    <!-- Pantalla de Juego -->
    <div id="game-screen" class="hidden flex-grow flex flex-col">
        <div class="bg-white text-slate-800 p-4 flex justify-between items-center shadow-md">
            <div class="font-bold text-xl">Pregunta <span id="current-q-num">1</span>/<span id="total-q-num"></span></div>
            <div class="bg-slate-200 w-32 h-4 rounded-full overflow-hidden">
                <div id="timer-bar" class="progress-bar h-full bg-[#1368ce]" style="width: 100%"></div>
            </div>
            <div class="font-bold text-xl">Puntos: <span id="score">0</span></div>
        </div>

        <div class="flex-grow flex flex-col items-center justify-center p-6 text-center">
            <h2 id="question-text" class="text-3xl md:text-4xl font-black mb-8 drop-shadow-lg"></h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-5xl">
                <button onclick="checkAnswer(0)" class="kahoot-btn option-0 p-6 rounded-lg text-left flex items-center min-h-[100px] text-xl font-bold">
                    <span class="shape mr-4"><i class="fas fa-triangle"></i></span>
                    <span id="opt-0"></span>
                </button>
                <button onclick="checkAnswer(1)" class="kahoot-btn option-1 p-6 rounded-lg text-left flex items-center min-h-[100px] text-xl font-bold">
                    <span class="shape mr-4"><i class="fas fa-square"></i></span>
                    <span id="opt-1"></span>
                </button>
                <button onclick="checkAnswer(2)" class="kahoot-btn option-2 p-6 rounded-lg text-left flex items-center min-h-[100px] text-xl font-bold">
                    <span class="shape mr-4"><i class="fas fa-circle"></i></span>
                    <span id="opt-2"></span>
                </button>
                <button onclick="checkAnswer(3)" class="kahoot-btn option-3 p-6 rounded-lg text-left flex items-center min-h-[100px] text-xl font-bold">
                    <span class="shape mr-4"><i class="fas fa-rhombus"></i></span>
                    <span id="opt-3"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Feedback -->
    <div id="feedback-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full text-center modal-enter">
            <div id="feedback-icon" class="text-6xl mb-4"></div>
            <h2 id="feedback-title" class="text-3xl font-black mb-2 text-slate-800"></h2>
            <p id="feedback-points" class="text-xl font-bold text-slate-600 mb-6"></p>
            <button onclick="nextQuestion()" class="w-full bg-[#1368ce] text-white font-bold py-3 rounded-xl shadow-lg">Siguiente</button>
        </div>
    </div>

    <!-- Pantalla Final -->
    <div id="end-screen" class="hidden flex-grow flex flex-col items-center justify-center p-6 text-center">
        <h1 class="text-5xl font-black mb-8">¡Felicidades!</h1>
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-slate-800 max-w-md w-full">
            <p class="text-2xl mb-2">Puntuación Final:</p>
            <div class="text-6xl font-black text-[#46178f] mb-6" id="final-score">0</div>
            <p id="rank-message" class="text-lg font-medium mb-6 italic"></p>
            <button onclick="location.reload()" class="w-full bg-[#e21b3c] text-white font-bold py-4 rounded-xl text-xl shadow-lg">Volver a Jugar</button>
        </div>
    </div>

    <script>
        const questions = [
            { q: "¿En qué año nació San Josemaría?", options: ["1902", "1928", "1898", "1910"], correct: 0 },
            { q: "¿En qué ciudad nació?", options: ["Madrid", "Barbastro", "Zaragoza", "Logroño"], correct: 1 },
            { q: "¿Cómo se llama la madre de San Josemaría?", options: ["María", "Dolores", "Carmen", "Josefa"], correct: 1 },
            { q: "¿Cómo se llama su hermano pequeño?", options: ["Santiago", "Juan", "Luis", "Francisco"], correct: 0 },
            { q: "¿A quién daba catequesis San Josemaría en Madrid?", options: ["A universitarios", "A niños pobres", "A sacerdotes", "A militares"], correct: 1 },
            { q: "¿Dónde se escondía de niño cuando venían visitas a casa?", options: ["Bajo la cama", "Detrás del sofá", "Detrás de las cortinas", "En el armario"], correct: 2 },
            { q: "¿Qué profesión eligió San Josemaría a los 15 años?", options: ["Abogado", "Médico", "Sacerdote", "Arquitecto"], correct: 2 },
            { q: "¿En qué lugar celebró su primera misa?", options: ["En Barbastro", "En el Pilar de Zaragoza", "En Madrid", "En Roma"], correct: 1 },
            { q: "¿En qué fecha recibió la iluminación de fundar la Obra?", options: ["2 de octubre", "14 de febrero", "26 de junio", "9 de enero"], correct: 0 },
            { q: "¿Qué Papá le declaró santo?", options: ["Juan XXIII", "Pablo VI", "Juan Pablo II", "Benedicto XVI"], correct: 2 },
            { q: "¿En qué año fue canonizado?", options: ["1975", "2002", "1992", "2010"], correct: 1 },
            { q: "¿Cuál es la vocación que le mostró Dios?", options: ["Vivir solo", "Ser santo en el trabajo", "Hacer milagros", "Ir de misiones"], correct: 1 },
            { q: "¿A dónde le llevó su madre para agradecer su curación de niño?", options: ["Torreciudad", "El Pilar", "Fátima", "Lourdes"], correct: 0 },
            { q: "¿Qué significa ser buen cristiano según su mensaje?", options: ["Ir solo a misa", "Hacer las cosas por amor a Dios", "Ser muy serio", "Saber mucha teología"], correct: 1 },
            { q: "¿Dónde descansan actualmente sus restos?", options: ["Basílica de San Pedro", "Santa María de la Paz (Roma)", "Catedral de Madrid", "Zaragoza"], correct: 1 }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let timeLeft = 20;
        let timerInterval;
        let canAnswer = true;
        let musicPlaying = false;

        document.getElementById('total-q-num').innerText = questions.length;

        function playShortSound(id) {
            const sound = document.getElementById(id);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(() => {});
                setTimeout(() => {
                    sound.pause();
                    sound.currentTime = 0;
                }, 400); // Duración ultra-breve
            }
        }

        function playClick() {
            const sound = document.getElementById('audio-click');
            sound.currentTime = 0;
            sound.play().catch(() => {});
        }

        function toggleMusic() {
            const bgAudio = document.getElementById('audio-bg');
            const icon = document.getElementById('music-icon');
            if (musicPlaying) {
                bgAudio.pause();
                icon.className = "fas fa-volume-mute text-white";
            } else {
                bgAudio.play().catch(() => {});
                icon.className = "fas fa-volume-up text-white";
            }
            musicPlaying = !musicPlaying;
        }

        function startGame() {
            playClick();
            const bgAudio = document.getElementById('audio-bg');
            bgAudio.volume = 0.3;
            bgAudio.play().then(() => {
                musicPlaying = true;
                document.getElementById('music-icon').className = "fas fa-volume-up text-white";
            }).catch(() => {});

            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            canAnswer = true;
            timeLeft = 20;
            updateTimerDisplay();
            
            const q = questions[currentQuestionIndex];
            document.getElementById('current-q-num').innerText = currentQuestionIndex + 1;
            document.getElementById('question-text').innerText = q.q;
            
            for(let i=0; i<4; i++) {
                document.getElementById(`opt-${i}`).innerText = q.options[i];
            }

            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    checkAnswer(-1);
                }
            }, 100);
        }

        function updateTimerDisplay() {
            const bar = document.getElementById('timer-bar');
            bar.style.width = (timeLeft / 20 * 100) + "%";
        }

        function checkAnswer(index) {
            if (!canAnswer) return;
            canAnswer = false;
            clearInterval(timerInterval);

            const correct = questions[currentQuestionIndex].correct;
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackTitle = document.getElementById('feedback-title');
            const feedbackPoints = document.getElementById('feedback-points');
            
            if (index === correct) {
                playShortSound('audio-correct');
                const pts = Math.round(timeLeft * 50);
                score += pts;
                feedbackIcon.innerHTML = '✅';
                feedbackTitle.innerText = "¡Correcto!";
                feedbackTitle.className = "text-3xl font-black mb-2 text-green-600";
                feedbackPoints.innerText = `+${pts} puntos`;
            } else {
                playShortSound('audio-wrong');
                feedbackIcon.innerHTML = '❌';
                feedbackTitle.innerText = index === -1 ? "¡Tiempo!" : "¡Incorrecto!";
                feedbackTitle.className = "text-3xl font-black mb-2 text-red-600";
                feedbackPoints.innerText = "Era: " + questions[currentQuestionIndex].options[correct];
            }

            document.getElementById('score').innerText = score;
            document.getElementById('feedback-modal').classList.remove('hidden');
        }

        function nextQuestion() {
            playClick();
            document.getElementById('feedback-modal').classList.add('hidden');
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                showEndScreen();
            }
        }

        function showEndScreen() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            
            let msg = "";
            const maxScore = questions.length * 1000;
            if (score > maxScore * 0.8) msg = "¡Increíble! Eres un experto total.";
            else if (score > maxScore * 0.5) msg = "¡Muy bien! Conoces muy bien su vida.";
            else msg = "¡Buen trabajo! Sigue aprendiendo sobre el Padre.";
            
            document.getElementById('rank-message').innerText = msg;
        }
    </script>
</body>
</html>
